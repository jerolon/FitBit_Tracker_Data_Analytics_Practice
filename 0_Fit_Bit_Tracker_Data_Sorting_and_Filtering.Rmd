---
title: "0_Fit_Bit_Tracker_Data_Sorting_and_Filtering"
author: "Jeronimo Miranda"
date: '2023-05-05'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(skimr)
library(dplyr)
library(lubridate)
```

```{r directory setup, include = FALSE}
rstudioapi::getActiveDocumentContext
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

## Loading and exploring the data
We are using the data from <https://www.kaggle.com/datasets/arashnic/fitbit>. 
Assume the path to the data is in a folder above where the repository is.

### Daily activity data

I am loading the Ids as character because summary statistics like mean or meadian are irrelevant whereas string comparisons like do all have the same amount of characters and how many are unique are important.

```{r data loading}
data_path <- "../Fitabase Data 4.12.16-5.12.16/"
dailyActivity <- read_csv(paste0(data_path,"dailyActivity_merged.csv"), 
    col_types = cols(Id = col_character(), 
        ActivityDate = col_date(format = "%m/%d/%Y")))
skim_without_charts(dailyActivity)
```

Loaded the dates in the correct format. Since apart from date and Id all columns are numeric, it makes sense to use skim_without_charts which gives a statistical summary of each variable. The function output is rendered as an html table, which is quite nice.

What we can see from this summary:

* 33 unique Ids, all have 10 characters.
* Data was collected for 31 days.
* The minimum for **all** numeric variables is 0. This suggests empty days, maybe just days that people did not wear their devices. These rows should be eliminated.
* Column names do not need to be cleaned
* The data is in long format
* This data can help answer our question by telling us how frequently people track different activities. Before any analysis we can see that most activity is done via trackerDistance rather than LoggedActivities

Total distance is not the sum of TrackerDistance and LoggedActivitiesDistance, as one could assume. Rather it seems to be the sum of the ActiveDistances columns. Lack of metadata is killing me here.
```{r sum of distances}
filter(dailyActivity, TotalDistance != (LoggedActivitiesDistance + TrackerDistance))
```
#### Number of days tracked

We group the days by Id and then plot a histogram of how many days people in the dataset were tracked
```{r number of days tracked, echo=FALSE}
library(ggplot2)
select(dailyActivity, Id, ActivityDate) %>% group_by(Id) %>% summarise(N_days = n()) %>% ggplot() + geom_histogram(aes(x = N_days)) + theme_bw()
```

Running `select(dailyActivity, Id, ActivityDate) %>% distinct()` shows that there are no duplicate dates for any Id

Data seems very redundant. The files `dailyCalories_merged.csv`, `daily_Intensities_merged` and `dailySteps_merged.csv` are just column subsets of `dailyActivity_merged.csv`

### Heartrate seconds data

```{r load heart rate}
heartrate_seconds <- read_csv(paste0(data_path,"heartrate_seconds_merged.csv"), 
    col_types = cols(Id = col_character(), Time = col_character(), Value = col_double()))
heartrate_date_time <- transmute(heartrate_seconds, Id, date_time = mdy_hms(Time), Value, hour_of_day = hms::as_hms(date_time), dia = date(date_time))
skim_without_charts(heartrate_date_time)
```

Only 14 out of 33 volunteers use a tracker that gets heart-rate data

These graphics span 24 hour periods. So you can see that only 3 people do not use the device to track sleep. The data is smoothed for every user, so day to day variability is lost. Still you can see some patterns of when people tend to exercise more consistently. Later we can average by the heart rate in sliding windows to plot different days for each user. It is just that the raw data every 5 seconds is way too dense to be visualized directly, even for a single day for a single user.

```{r graph of heart rates, echo =FALSE}
heartrate_date_time %>% ggplot() + geom_smooth(aes(x = hour_of_day, y = Value), se=FALSE) + facet_wrap(~Id)
```